# NURBSNet

## Dashboards/Scripts

- download abc smt files by id or name: `analysis/abc_all/abc_ids_to_names_and_download.py` 
- view smt images sorted by number of faces: `analysis/abc_all/abc_preview_sorted.py`
- view gram loss per layer between set of solids: `analysis/abc_all/vis_gram_loss.py`
- figures for paper generated by code in `analysis/figures_for_paper/`
- visualize gradients `visualize_gram_loss.py`

To generate thumbnails from meshes: `dataset/plot_meshes.py`
    - check paths in script for input/output dirs

To run scripts requiring precomputed grams:

- download grams to `analysis/{MODEL_NAME}_data/{DATASET_NAME}_{TYPE}`
- i.e. for MeshCNN SolidMNIST grams for four font subset:
    - download and extract `meshcnn_solidmnist_font_subset.7z` to `analysis/meshcnn_data/solidmnist_font_subset`
    - the directory structure should be as below:

```
PROJECT_ROOT
|
+- analysis
  |
  +- meshcnn_data
    |
    +- solidmnist_font_subset
      |
      +- 0_grams.npy
      +- 1_grams.npy
      ...
      +- graph_files.txt
```

## Requirements

- swap `dgl-cu101` in `requirmenets.txt:3` for your the correct cuda version for your system. i.e. `cdl-cu102`, `dgl-cu100`, etc.
- for cpu only use `dgl`
- may need to install cudatoolkit/set environment variable `LD_LIBRARY_PATH`

```bash
$ pip install -r requirements.txt
```

## SolidMNIST Data

Data should be extracted to `dataset/bin/train` and `dataset/bin/test`. This can be done manually or with the following script.

Requires:

- 7z
    - `$ sudo apt-get install p7zip-full` (linux)
    - `$ brew install p7zip` (mac)
- AWS CLI
    - should be ready installed/confgured on AWS EC2 instance
    - see [wiki](https://wiki.autodesk.com/pages/viewpage.action?spaceKey=MINT&title=AI+Engineering+Self-Service+AWS+Resources) and [blog post](https://engineering.autodesk.com/blog/how-to-use-the-aws-cli-from-multiple-accounts-simultaneously-in-highly-secure-assumeiamrole-policy-environments/) to install/configure locally

```bash
$ bash dataset/download_data.sh
```

## Training/Testing

- `train_classifier.py` (SolidMNIST)
- `test_classifier.py` (SolidMNIST) <-- use args `--state PATH_TO_SAVED_MODEL`

For ABC - use branch `abc`

- for font all/subset/single letter replace dataset class in test file (line 181) with `SolidMNIST()`/`SolidMNISTSubset()` etc.
- for x/z random rotation - use arg in dataset class
- all dataset classes implemented in `solidmnist.py` and `abcdataset.py`
- for grams/embeddings:
    - check output path as first line of main in test file
    - all grams should be saved there along with `graph_files.txt` which lists the files in order with the grams/embeddings

## CPU Only Testing

- replace line 161 in `test_classifier.py` with `device = 'cpu'`

## Debugging

- to enable step through model during testing set `num_workers = 0` in `helper.py:80`

##AWS

All experiments performed on AWS EC2:
- all python training/evaluation - p3.2xlarge - Deep Learning AMI (Ubuntu) Version 23.0
- data generation C++/ASM code/python scripts - t2.2xlarge - ami-0cb8c277ab5436fac (Windows)
    - AMI image with all ASM/TK + Visual Studio/PyCharm created: `t_meltp-windows-uvnet-datagen`